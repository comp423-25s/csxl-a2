<h1>Manage Chatbot Response Ratings</h1>
<div class="search-bar">
  <mat-form-field appearance="outline">
    <mat-label>User ID</mat-label>
    <input matInput [(ngModel)]="userId" placeholder="Enter User ID" type="number" />
  </mat-form-field>
  <button (click)="searchUserConversations()" mat-flat-button color="primary">Search</button>
</div>

<div *ngIf="conversations.length > 0">
  <h2>Conversations</h2>
  <mat-accordion>
    <mat-expansion-panel *ngFor="let convo of conversations">
      <mat-expansion-panel-header>
        <mat-panel-title>
          Conversation ID: {{ convo.id }}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div *ngFor="let message of convo.messages" class="message-item">
        <span class="sender-tag">{{ message.sender }}</span>
        <span class="message-text">{{ message.content }}</span>
        <span class="rating-badge" [ngClass]="{
          'good-rating': message.rating >= 4,
          'bad-rating': message.rating <= 2
        }">
          Rating: {{ message.rating || 'N/A' }}
        </span>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>

<div *ngIf="averageRating !== null">
  <h2>Average Rating</h2>
  <p class="average-rating">{{ averageRating.toFixed(2) }}/5</p>
</div>

<div *ngIf="messageCountsByDate">
  <h2>Messages per Day</h2>
  <mat-list>
    <mat-list-item *ngFor="let entry of messageCountsByDate | keyvalue">
      {{ entry.key }} â€” <strong>{{ entry.value }}</strong> messages
    </mat-list-item>
  </mat-list>
</div>
